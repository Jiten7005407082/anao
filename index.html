<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Tambola â€” Host Controlled (GitHub Pages)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#071427;--card:#0b1320;--accent:#ffd166;--accent-2:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#e6eef6;background:linear-gradient(180deg,#021222 0%, #052233 100%);-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:18px auto;padding:18px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(3,8,20,0.6);border:1px solid rgba(255,255,255,0.02)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type=text]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:var(--accent);border:none;color:#072022;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .muted-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px;border-radius:10px;cursor:pointer}
    .small{font-size:13px;color:var(--muted)}
    .ticket{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:12px;border-radius:10px}
    .ticket-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:6px}
    .cell{height:52px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;background:rgba(255,255,255,0.02);color:#dbeafe}
    .blank{background:transparent;color:transparent;font-weight:400}
    .called{background:linear-gradient(180deg, #ffe8a8, #ffd166);color:#091827;box-shadow:0 6px 18px rgba(255,209,102,0.12)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .called-numbers{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
    .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:10px;font-weight:700}
    .flex-between{display:flex;justify-content:space-between;align-items:center}
    .linkbox{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px}
    .voice-toggle{display:flex;gap:8px;align-items:center}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    .tag{font-size:12px;padding:4px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted)}
    @media(max-width:880px){.grid{grid-template-columns:1fr} .cell{height:44px;font-size:14px}}  
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Mini Tambola â€” Host Controlled (GitHub Pages)</h1>
      <div class="small">Static host + client sync â€¢ Voice announcer (GB)</div>
    </header>

    <div class="grid">
      <!-- LEFT: Room / Host Controls -->
      <div class="card">
        <div>
          <label>Room Code (share with players)</label>
          <input id="roomCode" type="text" value="ROOM123" />
        </div>

        <div style="margin-top:10px" class="flex-between">
          <div class="row">
            <label style="margin:0">Role</label>
            <div style="display:flex;gap:8px;margin-left:8px">
              <button id="modeHost" class="small">Host</button>
              <button id="modePlayer" class="small muted-btn">Player</button>
            </div>
          </div>
          <div class="voice-toggle">
            <label class="small" style="margin:0">Voice</label>
            <select id="voiceSelect" class="muted-btn" style="padding:6px;border-radius:8px">
              <option value="gb">British English (GB)</option>
              <option value="us">American English (US)</option>
            </select>
            <button id="voiceOnOff" class="muted-btn">ðŸ”ˆ On</button>
          </div>
        </div>

        <div id="hostControls" style="display:block;margin-top:12px">
          <label>Host Controls</label>
          <div class="controls">
            <button id="startGame">Start Game</button>
            <button id="callNext">Call Next Number</button>
            <button id="resetCalled" class="muted-btn">Reset Called</button>
            <button id="copyState" class="muted-btn">Copy State Link</button>
            <button id="exportState" class="muted-btn">Export State Text</button>
            <button id="downloadTicketImg" class="muted-btn">Download Ticket PNG</button>
          </div>

          <div style="margin-top:10px" class="small">Called Numbers</div>
          <div id="calledList" class="called-numbers"></div>
        </div>

        <div id="playerControls" style="display:none;margin-top:8px">
          <label>Player Controls</label>
          <div class="row" style="margin-top:6px">
            <input id="playerName" type="text" placeholder="Your name (for deterministic ticket)" />
            <button id="getTicket" class="small" style="margin-left:8px">Get Ticket</button>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="syncFromLink" class="muted-btn">Paste State Text</button>
            <button id="clearMarks" class="muted-btn">Clear Marks</button>
          </div>
        </div>

        <footer>
          Tips: Host clicks <strong>Start Game</strong> then <strong>Call Next Number</strong>. Use <strong>Copy State Link</strong> to share the current called numbers with players. Voice annnouncer uses your browser's speech synthesis.
        </footer>
      </div>

      <!-- RIGHT: Ticket & Game View -->
      <div class="card">
        <div class="flex-between">
          <div>
            <label>Active Game</label>
            <div id="activeInfo" class="small">Not started</div>
          </div>
          <div class="row">
            <div class="small">Last called:</div>
            <div id="lastCalled" class="chip">â€”</div>
          </div>
        </div>

        <hr style="border:none;height:10px;opacity:0.02" />

        <div style="display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1;min-width:260px">
            <label>Ticket</label>
            <div id="ticketArea" class="ticket" style="margin-top:8px">
              <div id="ticketGrid" class="ticket-grid"></div>
            </div>

            <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
              <button id="regenTicket" class="muted-btn">Regenerate Ticket</button>
              <button id="downloadTicket" class="muted-btn">Download PNG</button>
              <div id="ticketName" class="small" style="margin-left:auto;color:var(--muted)"></div>
            </div>
          </div>

          <div style="width:280px;min-width:240px">
            <label>Called Numbers (quick view)</label>
            <div id="calledGrid" class="ticket" style="margin-top:8px;padding:12px">
              <div id="calledGridInner" class="ticket-grid"></div>
            </div>

            <div style="margin-top:10px">
              <label>Share / Sync</label>
              <div class="linkbox" id="shareBox">No state copied</div>
