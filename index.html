<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Tambola Hosted</title>
<style>
body {font-family: Arial, sans-serif; background:#071427; color:#e6eef6; margin:0; padding:0;}
.wrap {max-width:1000px; margin:20px auto; padding:20px;}
header {display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
.card {background:rgba(11,19,32,0.9); padding:20px; border-radius:12px; margin-bottom:20px;}
.ticket-grid {display:grid; grid-template-columns:repeat(9,1fr); gap:4px; margin-top:10px;}
.cell {height:40px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.05); border-radius:6px; font-weight:bold;}
.called {background:#ffd166; color:#071427;}
.chip {display:inline-block; background:rgba(255,255,255,0.1); padding:4px 6px; margin:2px; border-radius:6px; font-weight:bold;}
button {padding:8px 12px; margin:4px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>Mini Tambola Host</h1>
<div>Static hosted, multi-player tickets, GB voice announce</div>
</header>
<div class="card">
<label>Room Code: <input type="text" id="roomCode" value="ROOM123"/></label>
<div style="margin-top:10px;">
<button id="startGame">Start Game</button>
<button id="callNext" disabled>Call Next Number</button>
<button id="resetCalled">Reset Called</button>
</div>
<div style="margin-top:10px;">Called Numbers:</div>
<div id="calledList"></div>
<div style="margin-top:10px;">Last Called: <span id="lastCalled">—</span></div>
</div>

<div class="card">
<label>Ticket:</label>
<div id="ticketGrid" class="ticket-grid"></div>
<button id="generateTicket">Generate Ticket</button>
</div>
</div>

<script>
// Initialize game state
const gameState = {room:'', started:false, called:[], ticket:[]};
let voices = [];

// Load voices properly
function loadVoices(callback){
    voices = speechSynthesis.getVoices();
    if(voices.length > 0){
        callback();
    } else {
        speechSynthesis.onvoiceschanged = () => {
            voices = speechSynthesis.getVoices();
            callback();
        };
    }
}

// Speech function
function speakText(txt){
    if(!voices || voices.length===0) return;
    const chosen = voices.find(v=>v.lang.toLowerCase().startsWith('en-gb')) || voices[0];
    const utter = new SpeechSynthesisUtterance(txt);
    utter.voice = chosen;
    utter.rate = 0.95;
    speechSynthesis.speak(utter);
}

// Utility: generate simple 3x9 ticket
function generateTicket(){
    const numbers = Array.from({length:90},(_,i)=>i+1);
    const ticket=[];
    for(let r=0;r<3;r++){
        const row=[];
        for(let c=0;c<9;c++){
            if(Math.random()<0.3){
                const idx=Math.floor(Math.random()*numbers.length);
                row.push(numbers.splice(idx,1)[0]);
            } else {row.push('');}
        }
        ticket.push(row);
    }
    gameState.ticket=ticket;
    renderTicket();
}

function renderTicket(){
    const grid=document.getElementById('ticketGrid');
    grid.innerHTML='';
    gameState.ticket.forEach(row=>row.forEach(num=>{
        const div=document.createElement('div');
        div.className='cell';
        div.textContent=num || '';
        grid.appendChild(div);
    }));
}

// Start Game button
document.getElementById('startGame').addEventListener('click',()=>{
    loadVoices(()=>{
        gameState.room = document.getElementById('roomCode').value || 'ROOM123';
        gameState.started = true;
        gameState.called = [];
        document.getElementById('calledList').innerHTML='';
        document.getElementById('lastCalled').textContent='—';
        document.getElementById('callNext').disabled=false;
        speakText('Game started for room ' + gameState.room);
    });
});

// Call Next Number
document.getElementById('callNext').addEventListener('click',()=>{
    if(!gameState.started){alert('Start the game first!'); return;}
    const remaining = Array.from({length:90},(_,i)=>i+1).filter(n=>!gameState.called.includes(n));
    if(remaining.length===0){alert('All numbers called!'); return;}
    const next=remaining[Math.floor(Math.random()*remaining.length)];
    gameState.called.push(next);
    document.getElementById('lastCalled').textContent=next;
    document.getElementById('calledList').innerHTML=gameState.called.map(n=>`<span class="chip">${n}</span>`).join('');
    speakText('Number ' + next);
});

// Reset called numbers
document.getElementById('resetCalled').addEventListener('click',()=>{
    gameState.called=[];
    document.getElementById('calledList').innerHTML='';
    document.getElementById('lastCalled').textContent='—';
});

// Generate ticket button
document.getElementById('generateTicket').addEventListener('click',()=>{
    generateTicket();
});

// Generate initial ticket
generateTicket();
</script>
</body>
</html>
